<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ex 4: Killer Whale • MixSIAR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Ex 4: Killer Whale">
<meta property="og:description" content="MixSIAR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MixSIAR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.1.12</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-book"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/index.html">Overview</a>
    </li>
    <li>
      <a href="../articles/wolves_ex.html">Ex 1: Wolves</a>
    </li>
    <li>
      <a href="../articles/geese_ex.html">Ex 2: Geese</a>
    </li>
    <li>
      <a href="../articles/lake_ex.html">Ex 3: Lake</a>
    </li>
    <li>
      <a href="../articles/killerwhale_ex.html">Ex 4: Killer whale</a>
    </li>
    <li>
      <a href="../articles/isopod_ex.html">Ex 5: Isopod</a>
    </li>
    <li>
      <a href="../articles/cladocera_ex.html">Ex 6: Cladocera</a>
    </li>
    <li>
      <a href="../articles/modify_output.html">Modifying output plots</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="https://github.com/brianstock/MixSIAR">
    <span class="fa fa-github fa-lg"></span>
     
    Source code
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/brianstock/MixSIAR/issues/">
    <span class="fa fa-question-circle-o"></span>
     
    Issues
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Ex 4: Killer Whale</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/brianstock/MixSIAR/blob/master/vignettes/killerwhale_ex.Rmd"><code>vignettes/killerwhale_ex.Rmd</code></a></small>
      <div class="hidden name"><code>killerwhale_ex.Rmd</code></div>

    </div>

    
    
<p>Here we step through the Killer Whale Example using the <strong>script</strong> version of MixSIAR. For a demonstration using the <strong>GUI</strong> version, see the <a href="https://github.com/brianstock/MixSIAR/blob/master/inst/mixsiar_manual_small.pdf">MixSIAR Manual</a>. For a thorough walkthrough of how to use MixSIAR in a script, see the <a href="https://brianstock.github.io/MixSIAR/articles/wolves_ex.html">Wolves Example</a>, which provides more commentary and explanation.</p>
<p>For a clean, runnable <code>.R</code> script, look at <code>mixsiar_script_killerwhale.R</code> in the <code>example_scripts</code> folder of the MixSIAR package install:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/brianstock/MixSIAR">MixSIAR</a></span><span class="op">)</span>
<span class="va">mixsiar.dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/find.package.html">find.package</a></span><span class="op">(</span><span class="st">"MixSIAR"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">mixsiar.dir</span>,<span class="st">"/example_scripts"</span><span class="op">)</span></pre></div>
<p>You can run the killer whale example script directly with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">mixsiar.dir</span>,<span class="st">"/example_scripts/mixsiar_script_killerwhale.R"</span><span class="op">)</span><span class="op">)</span></pre></div>
<div id="killer-whale-example" class="section level2">
<h2 class="hasAnchor">
<a href="#killer-whale-example" class="anchor"></a>Killer Whale Example</h2>
<p>The Killer Whale Example demonstrates the difference <strong>informative priors</strong> make, and illustrates how to construct them:</p>
<ul>
<li>2 biotracers (<span class="math inline">\(\delta^{13}\)</span>C, <span class="math inline">\(\delta^{15}\)</span>N)</li>
<li>Source data as means + SDs</li>
<li><strong>Informative vs. uninformative priors</strong></li>
</ul>
<div id="load-mixsiar-package" class="section level3">
<h3 class="hasAnchor">
<a href="#load-mixsiar-package" class="anchor"></a>Load MixSIAR package</h3>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/brianstock/MixSIAR">MixSIAR</a></span><span class="op">)</span></pre></div>
</div>
<div id="load-mixture-data" class="section level3">
<h3 class="hasAnchor">
<a href="#load-mixture-data" class="anchor"></a>Load mixture data</h3>
<p>See ?load_mix_data for details.</p>
<p>The killer whale consumer data has no covariates—we are estimating the diet of one population where all individuals are considered identical (<code>factors=NULL</code>, <code>fac_random=NULL</code>, <code>fac_nested=NULL</code>, <code>cont_effects=NULL</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="co"># Replace the system.file call with the path to your file</span>
<span class="va">mix.filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"killerwhale_consumer.csv"</span>, package <span class="op">=</span> <span class="st">"MixSIAR"</span><span class="op">)</span>

<span class="va">mix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_mix_data.html">load_mix_data</a></span><span class="op">(</span>filename<span class="op">=</span><span class="va">mix.filename</span>,
                     iso_names<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"d13C"</span>,<span class="st">"d15N"</span><span class="op">)</span>,
                     factors<span class="op">=</span><span class="cn">NULL</span>,
                     fac_random<span class="op">=</span><span class="cn">NULL</span>,
                     fac_nested<span class="op">=</span><span class="cn">NULL</span>,
                     cont_effects<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></pre></div>
</div>
<div id="load-source-data" class="section level3">
<h3 class="hasAnchor">
<a href="#load-source-data" class="anchor"></a>Load source data</h3>
<p>See ?load_source_data for details.</p>
<p>We do not have any fixed/random/continuous effects or concentration dependence in the source data (<code>source_factors=NULL</code>, <code>conc_dep=FALSE</code>). We only have source means, SD, and sample size—not the original “raw” data (<code>data_type="means"</code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="co"># Replace the system.file call with the path to your file</span>
<span class="va">source.filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"killerwhale_sources.csv"</span>, package <span class="op">=</span> <span class="st">"MixSIAR"</span><span class="op">)</span>

<span class="va">source</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_source_data.html">load_source_data</a></span><span class="op">(</span>filename<span class="op">=</span><span class="va">source.filename</span>,
                           source_factors<span class="op">=</span><span class="cn">NULL</span>,
                           conc_dep<span class="op">=</span><span class="cn">FALSE</span>,
                           data_type<span class="op">=</span><span class="st">"means"</span>,
                           <span class="va">mix</span><span class="op">)</span></pre></div>
</div>
<div id="load-discrimination-data" class="section level3">
<h3 class="hasAnchor">
<a href="#load-discrimination-data" class="anchor"></a>Load discrimination data</h3>
<p>See ?load_discr_data for details.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="co"># Replace the system.file call with the path to your file</span>
<span class="va">discr.filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"killerwhale_discrimination.csv"</span>, package <span class="op">=</span> <span class="st">"MixSIAR"</span><span class="op">)</span>

<span class="va">discr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_discr_data.html">load_discr_data</a></span><span class="op">(</span>filename<span class="op">=</span><span class="va">discr.filename</span>, <span class="va">mix</span><span class="op">)</span></pre></div>
</div>
<div id="plot-data" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-data" class="anchor"></a>Plot data</h3>
<p>This is your chance to check:</p>
<ul>
<li>Are the data loaded correctly?</li>
<li>Is your mixture data in the source polygon?</li>
<li>Are one or more of your sources confounded/hidden?</li>
</ul>
<p>Notice that the high degree of correlation places the sources on a line, which makes it difficult for the model to determine if killer whales are eating Chinook vs. Coho, or Sockeye vs. Steelhead vs. Chum. We can give the model additional information to resolve this problem by using an <strong>informative prior.</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="co"># Make an isospace plot</span>
<span class="fu"><a href="../reference/plot_data.html">plot_data</a></span><span class="op">(</span>filename<span class="op">=</span><span class="st">"isospace_plot"</span>, plot_save_pdf<span class="op">=</span><span class="cn">TRUE</span>, plot_save_png<span class="op">=</span><span class="cn">FALSE</span>, <span class="va">mix</span>,<span class="va">source</span>,<span class="va">discr</span><span class="op">)</span></pre></div>
</div>
<div id="run-the-model-with-uninformative-prior" class="section level3">
<h3 class="hasAnchor">
<a href="#run-the-model-with-uninformative-prior" class="anchor"></a>Run the model with <strong>uninformative</strong> prior</h3>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="co"># Plot uninformative prior</span>
<span class="fu"><a href="../reference/plot_prior.html">plot_prior</a></span><span class="op">(</span>alpha.prior<span class="op">=</span><span class="fl">1</span>, <span class="va">source</span>, filename <span class="op">=</span> <span class="st">"prior_plot_kw_uninf"</span><span class="op">)</span>

<span class="co"># Define model structure and write JAGS model file</span>
<span class="va">model_filename</span> <span class="op">&lt;-</span> <span class="st">"MixSIAR_model_kw_uninf.txt"</span>   <span class="co"># Name of the JAGS model file</span>
<span class="va">resid_err</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
<span class="va">process_err</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
<span class="fu"><a href="../reference/write_JAGS_model.html">write_JAGS_model</a></span><span class="op">(</span><span class="va">model_filename</span>, <span class="va">resid_err</span>, <span class="va">process_err</span>, <span class="va">mix</span>, <span class="va">source</span><span class="op">)</span>

<span class="co"># Run the JAGS model ("very long" took ~5 min)</span>
<span class="va">jags.uninf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_model.html">run_model</a></span><span class="op">(</span>run<span class="op">=</span><span class="st">"test"</span>,<span class="va">mix</span>,<span class="va">source</span>,<span class="va">discr</span>,<span class="va">model_filename</span><span class="op">)</span>
<span class="co"># jags.uninf &lt;- run_model(run="very long",mix,source,discr,model_filename)</span>

<span class="co"># Process diagnostics, summary stats, and posterior plots</span>
<span class="fu"><a href="../reference/output_JAGS.html">output_JAGS</a></span><span class="op">(</span><span class="va">jags.uninf</span>, <span class="va">mix</span>, <span class="va">source</span><span class="op">)</span></pre></div>
</div>
<div id="run-the-model-with-informative-prior" class="section level3">
<h3 class="hasAnchor">
<a href="#run-the-model-with-informative-prior" class="anchor"></a>Run the model with <strong>informative</strong> prior</h3>
<p>From Semmens et al. (in prep):</p>
<p>One of the benefits to conducting mixture models in a Bayesian framework is that information from other data sources can be included via informative prior distributions <a href="https://doi.org/10.1111/j.1461-0248.2008.01163.x">Moore and Semmens 2008</a>. Suppose we have collected 14 fecal samples from the killer whale population we are studying, and we find 10 chinook, 1 chum, 0 coho, 0 sockeye, and 3 steelhead. The sum of the Dirichlet hyperparameters roughly correspond to prior sample size, so one approach would be to construct a prior with <span class="math inline">\(\alpha\)</span> = (10, 1, 0, 0, 3). A downside of this prior is that a sample size of 14 represents a very informative prior, with much of the parameter space given very little weight. Keeping the relative contributions the same, the hyperparameters can be rescaled to have the same mean, but different variance. An alternative is to scale the prior to have a weight of 5, equal to the same weight as the “uninformative” prior <span class="math inline">\(\alpha\)</span> = (1, 1, 1, 1, 1). This prior could be represented as <span class="math inline">\(\alpha=\left(\frac{10*5}{14},\frac{1*5}{14},\frac{0*5}{14},\frac{0*5}{14},\frac{3*5}{14}\right)=\left(3.57,0.36,0.01,0.01,1.07\right)\)</span>.</p>
<p>You cannot have <span class="math inline">\(\alpha\)</span> parameters = 0, so while we had no coho and sockeye in our fecal samples, we set their α parameters = 0.01. Remember that the sources are sorted alphabetically.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="co"># Our 14 fecal samples were 10, 1, 0, 0, 3</span>
<span class="va">kw.alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>

<span class="co"># Generate alpha hyperparameters scaling sum(alpha)=n.sources</span>
<span class="va">kw.alpha</span> <span class="op">&lt;-</span> <span class="va">kw.alpha</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">kw.alpha</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">kw.alpha</span><span class="op">)</span>

<span class="co"># the Dirichlet hyperparameters for the alpha.prior cannot be 0 (but can set = .01)</span>
<span class="va">kw.alpha</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">kw.alpha</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.01</span>

<span class="co"># Plot your informative prior</span>
<span class="fu"><a href="../reference/plot_prior.html">plot_prior</a></span><span class="op">(</span>alpha.prior<span class="op">=</span><span class="va">kw.alpha</span>,
           source<span class="op">=</span><span class="va">source</span>,
           plot_save_pdf<span class="op">=</span><span class="cn">TRUE</span>,
           plot_save_png<span class="op">=</span><span class="cn">FALSE</span>,
           filename<span class="op">=</span><span class="st">"prior_plot_kw_inf"</span><span class="op">)</span>

<span class="co"># Define model structure and write JAGS model file</span>
<span class="va">model_filename</span> <span class="op">&lt;-</span> <span class="st">"MixSIAR_model_kw_inf.txt"</span>   <span class="co"># Name of the JAGS model file</span>
<span class="va">resid_err</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
<span class="va">process_err</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>
<span class="fu"><a href="../reference/write_JAGS_model.html">write_JAGS_model</a></span><span class="op">(</span><span class="va">model_filename</span>, <span class="va">resid_err</span>, <span class="va">process_err</span>, <span class="va">mix</span>, <span class="va">source</span><span class="op">)</span>

<span class="co"># Run the JAGS model ("very long" took ~5 min)</span>
<span class="va">jags.inf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_model.html">run_model</a></span><span class="op">(</span>run<span class="op">=</span><span class="st">"test"</span>,<span class="va">mix</span>,<span class="va">source</span>,<span class="va">discr</span>,<span class="va">model_filename</span>,alpha.prior<span class="op">=</span><span class="va">kw.alpha</span><span class="op">)</span>
<span class="co"># jags.inf &lt;- run_model(run="very long",mix,source,discr,model_filename,alpha.prior=kw.alpha)</span>

<span class="co"># Process diagnostics, summary stats, and posterior plots</span>
<span class="fu"><a href="../reference/output_JAGS.html">output_JAGS</a></span><span class="op">(</span><span class="va">jags.inf</span>, <span class="va">mix</span>, <span class="va">source</span><span class="op">)</span></pre></div>
<p>The <code>plot_prior</code> function shows <a href="https://github.com/brianstock/MixSIAR/blob/master/Manual/kw_prior_plot.pdf">your prior next to the uninformative prior</a>. Compare the model results with the <a href="https://github.com/brianstock/MixSIAR/blob/master/Manual/kw_uninf_posterior_density_diet_p_global.pdf">uninformative prior</a> with those from the <a href="https://github.com/brianstock/MixSIAR/blob/master/Manual/kw_inf_posterior_density_diet_p_global.pdf">informative prior</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Brian Stock, Brice Semmens.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
